<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.mapper.ProductMapper">

	<!--	상품 등록 -->
	<insert id="insertProduct" useGeneratedKeys="true" keyProperty="productId">
		INSERT INTO product (
    		seller_id, title, description, price, status, created_at, latitude, longitude
		)
		VALUES (
		    #{sellerId}, #{title}, #{description}, #{price}, 0, NOW(), #{lat}, #{lon}
		)
	</insert>

	<!--	상품 상세 조회 -->
	<select id="getProduct" resultType="com.itwillbs.domain.ProductVO">
	    SELECT
	        product_id AS productId,
	        seller_id AS sellerId,
	        title,
	        description,
	        price,
	        status,
	        created_at AS createdAt,
	        latitude AS lat,   
	        longitude AS lon
	    FROM product
	    WHERE product_id = #{productId}
	</select>

	<!--	전체 상품 리스트 -->
	<select id="getProductList" resultType="com.itwillbs.domain.ProductVO">
		SELECT
			product_id AS productId,
			seller_id AS sellerId,
			title,
			description,
			price,
			status,
			created_at AS createdAt
		FROM product
		ORDER BY product_id DESC
	</select>
	
	<!-- 내 상품 리스트 -->
	<select id="getMyProductList" resultType="com.itwillbs.domain.ProductVO">
		SELECT
			product_id AS productId,
			seller_id AS sellerId,
			title,
			description,
			price,
			status,
			created_at AS createdAt
		FROM product
		WHERE seller_id = #{sellerId}
		ORDER BY product_id DESC
	</select>

	<!--	상품 수정 -->
	<update id="updateProduct">
		UPDATE product
		SET
			title = #{title},
			description = #{description},
			price = #{price},
			status = #{status},
			latitude = #{lat},
			longitude = #{lon}
		WHERE product_id = #{productId}
	</update>
	
	<update id="updateStatus">
	    UPDATE product
	    SET status = #{status}
	    WHERE product_id = #{productId}
	</update>

	<!--	최신 상품 리스트 (메인 6개) -->
	<select id="getRecentProducts" resultType="com.itwillbs.domain.ProductVO">
	    SELECT
	        product_id AS productId,
	        seller_id AS sellerId,
	        title,
	        description,
	        price,
	        status,
	        created_at AS createdAt,
	        images
	    FROM product
	    WHERE status = 0
	    ORDER BY product_id DESC
	    LIMIT 6
	</select>
	
	<!-- 페이징 목록 조회 -->
	<select id="getListPaging" resultType="com.itwillbs.domain.ProductVO">
	    SELECT
	        product_id AS productId,
	        seller_id AS sellerId,
	        title,
	        description,
	        price,
	        status,
	        created_at AS createdAt,
	        images
	    FROM product
	    WHERE status = 0
	    <if test="search != null and search != ''">
	        AND title LIKE CONCAT('%', #{search}, '%')
	    </if>
	    ORDER BY product_id DESC
	    LIMIT #{pageStart}, #{pageSize}
	</select>
	
	<!-- 총 개수 -->
	<select id="getTotalCount" resultType="int">
	    SELECT COUNT(*)
	    FROM product
	    WHERE status = 0
	    <if test="search != null and search != ''">
	        AND title LIKE CONCAT('%', #{search}, '%')
	    </if>
	</select>

</mapper>
